<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Blogify - Home</title>
    <style>
        body {
          font-family: Arial, sans-serif;
          background: #f5f7fa;
          margin: 0;
          padding: 0;
        }

        /* Navbar */
        header {
          background: #4a90e2;
          color: #fff;
          padding: 1rem 2rem;
          display: flex;
          justify-content: space-between;
          align-items: center;
        }

        header h1 {
          margin: 0;
          font-size: 1.6rem;
        }

        nav a {
          background: #fff;
          color: #4a90e2;
          text-decoration: none;
          padding: 0.5rem 1rem;
          border-radius: 6px;
          font-size: 0.95rem;
          transition: background 0.3s, color 0.3s;
        }

        nav a:hover {
          background: #357abd;
          color: #fff;
        }

        /* Post list */
        .container {
          max-width: 800px;
          margin: 2rem auto;
          padding: 0 1rem;
        }

        .post {
          background: #fff;
          padding: 1.5rem;
          margin-bottom: 1.5rem;
          border-radius: 12px;
          box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .post h2 {
          margin-top: 0;
          color: #333;
          font-size: 1.5rem;
        }

        .post h2 a {
          text-decoration: none;
          color: #4a90e2;
        }

        .post h2 a:hover {
          text-decoration: underline;
        }

        .post p {
          color: #555;
          line-height: 1.6;
          margin: 0.5rem 0 1rem;
        }

        .author {
          font-size: 0.9rem;
          color: #777;
        }
    </style>
</head>
<body>
<header>
    <h1>Blogify - All Posts</h1>
    <nav>
        <a href="my-posts.html">Manage My Posts</a>
    </nav>
</header>

<div class="container" id="postsContainer">
    <p>Loading posts...</p>
</div>

<script>
    async function fetchPosts() {
        try {
            const token = localStorage.getItem('jwt');
            if (!token) {
                alert('No authentication token found. Please login.');
                window.location.href = 'Login.html';
                return;
            }

            const response = await fetch('/api/posts', {
                headers: {
                    'Authorization': `Bearer ${token}`,
                    'Content-Type': 'application/json'
                }
            });

            const container = document.getElementById('postsContainer');

            if (response.ok) {
                const posts = await response.json();
                container.innerHTML = '';

                if (posts.length === 0) {
                    container.innerHTML = '<p>No posts available.</p>';
                    return;
                }

                posts.forEach(post => {
                    const postDiv = document.createElement('div');
                    postDiv.className = 'post';
                    postDiv.innerHTML = `
                        <h2><a href="Post.html?postId=${post.id}">${post.title}</a></h2>
                        <p>${post.content}</p>
                        <div class="author">- Author: ${post.author}</div>
                    `;
                    container.appendChild(postDiv);
                });
            } else if (response.status === 401 || response.status === 403) {
                localStorage.removeItem('jwt');
                alert('Authentication failed. Please login again.');
                window.location.href = 'Login.html';
            } else {
                container.innerHTML = '<p>Failed to load posts. Please try again later.</p>';
            }
        } catch (error) {
            console.error('Error:', error);
            document.getElementById('postsContainer').innerHTML = '<p>An error occurred while loading posts.</p>';
        }
    }

    document.addEventListener('DOMContentLoaded', fetchPosts);
</script>
</body>
</html>
